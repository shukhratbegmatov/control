import{_ as ue}from"./CLoader.vue_vue_type_script_setup_true_lang-DQKbESRQ.js";import{N as j,Q as pe,d as G,A as Q,i as d,h as me,v as fe,r as b,o as I,x as U,w as E,e as x,l as $,b as e,c as Z,f as C,H as ve,R as _e,j as o,z,F as ge,D as he,S as Ce,k as J,K as ye,L as we,u as Be,a as Ee,J as xe}from"./index-Dpjr3xtB.js";import"./moment-Cijl8gKs.js";import{_ as De,u as Ie,a as ke,r as W}from"./index-CLXDXuM8.js";import{_ as Ae}from"./CButton.vue_vue_type_style_index_0_lang-DreOhPd7.js";function Y(m){var k=m.getFullYear().toString(),g=(m.getMonth()+1).toString(),h=m.getDate().toString();return(h[1]?h:"0"+h[0])+"-"+(g[1]?g:"0"+g[0])+"-"+k}const be=["madaniykengash.uz","1AD8ACE51CFF0F17362C9280004D3C480B64D6D0F6B75E040CC06AAF20E7EAAA1BC80607CE1A546F278444161A3FB0867DAD5A351BCDB86D377AC563321023C5","localhost","96D0C1491615C82B9A54D9989779DF825B690748224C2B04F500F370D51827CE2644D8D4A82C18184D73AB8530BB8ED537269603F61DB0D03D2104ABF789970B","127.0.0.1","A7BCFA5D490B351BE0754130DF03A068F855DB4333D43921125B9CF2670EF6A40370C646B90401955E1F7BC9CDBF59CE0B2C5467D820BE189C845D0B79CFC96F","null","E0A205EC4E7B78BBB56AFF83A733A1BB9FD39D562E67978CC5E7D73B0951DB1954595A20672A63332535E13CC6EC1E1FC8857BB09E0855D7E76E411B6FA16E9D"],Se={api_keys:be},X={login:async function(m){return j.post("/user/login",m)},getChallenge(){return pe.get("https://api-control.madaniymeros.uz/v1/account/eimzo-challenge/")}},S=m=>(ye("data-v-190ebdc2"),m=m(),we(),m),Fe={class:"p-3",style:{"min-height":"300px"}},Oe={class:"grid grid-cols-12"},Te={key:0,class:"col-span-12"},Ne={class:""},Me={class:"grid grid-cols-12 gap-4"},$e={class:"col-span-12 text-success"},Ze={class:"col-span-4"},Pe=S(()=>e("label",{class:"name"}," STIR ",-1)),Ve={class:"col-span-4"},Le=S(()=>e("label",{class:"name"}," JSHSHIR ",-1)),Ue={class:"col-span-4"},ze=S(()=>e("label",{class:"name"}," Sertifikat raqami",-1)),Ke={class:"col-span-4"},Re=S(()=>e("label",{class:"name"}," Tashkilot",-1)),Je={class:"col-span-8"},He=S(()=>e("label",{class:"name"}," Sertifikatning amal qilish muddati",-1)),qe={class:"col-span-12 flex justify-end"},We="Ошибка соединения с E-IMZO. Возможно у вас не установлен модуль E-IMZO или Браузер E-IMZO.",K="Браузер не поддерживает технологию WebSocket. Установите последнюю версию браузера.",Ye='ВНИМАНИЕ !!! Установите новую версию приложения E-IMZO или Браузера E-IMZO.<br /><a href="https://e-imzo.uz/main/downloads/" role="button">Скачать ПО E-IMZO</a>',R="Пароль неверный.",je=G({__name:"Signature",props:{selectedDoc:{},withComment:{type:Boolean},show:{type:Boolean},isOnlyChallenge:{type:Boolean},loading:{type:Boolean}},emits:["success","update:show"],setup(m,{emit:k}){const g=Q.useToast();var h=3,P=37;const f=m,F=k;let y=d(""),O=d([]),w=d(!1),l=d(),p=d(!1),T=d(!1),V=d("");d(null);let A=d(),B=d(null),H=d(!1);function c(t){t.isTrusted&&!H.value?(g.warning("E-IMZO o'rnatilmagan"),H.value=!1):g.error(t)}me(()=>{re()});async function ee(t){var s,n;try{const i={signedContent:t,inn:(s=l.value)==null?void 0:s.TIN,pnfl:(n=l.value)==null?void 0:n.PINFL};f.withComment?F("success",{...i,comment:y.value}):F("success",i)}catch{}}async function te(t){l.value=t,V.value=t.serialNumber+" - "+t.CN,B.value===null&&await oe()}function se(t){let s=t+"=",i=decodeURIComponent(document.cookie).split(";");for(let u=0;u<i.length;u++){let r=i[u];for(;r.charAt(0)==" ";)r=r.substring(1);if(r.indexOf(s)==0)return r.substring(s.length,r.length)}return""}function ae(t){document.cookie=t+"=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function ne(t,s){var n=new Date,i=n.getTime();i+=3600*6e3,n.setTime(i);let u="expires="+n.toUTCString();document.cookie=t+"="+s+";"+u+";path=/"}async function oe(){var n,i;p.value=!0;let t=(n=A.value)==null?void 0:n.challenge;f.isOnlyChallenge||(t=JSON.stringify({...f.selectedDoc,challenge:(i=A.value)==null?void 0:i.challenge}));const s=new Promise((u,r)=>{var M;let N=se("keyId-"+((M=l.value)==null?void 0:M.TIN));N==""?EIMZOClient.loadKey(l.value,function(a){EIMZOClient.createPkcs7(a,t,null,function(v){var _;ne("keyId-"+((_=l.value)==null?void 0:_.TIN),a),u(v)},function(v,_){r("error"),p.value=!1,_?_.indexOf("BadPaddingException")!=-1?c(R):c(_):(document.getElementById("keyId").innerHTML="",c(K))})},function(a,v){r("error"),p.value=!1,v?v.indexOf("BadPaddingException")!=-1?c(R):c(v):c(K)}):EIMZOClient.createPkcs7(N,t,null,function(a){u(a)},function(a,v){var _;r("error"),p.value=!1,v?(ae("keyId-"+((_=l.value)==null?void 0:_.TIN)),v.indexOf("BadPaddingException")!=-1?c(R):c(v)):c(K)})});try{let u=await s;ee(u)}catch{c("Server error...")}finally{T.value=!1,p.value=!1}}async function le(){await te(l.value)}async function ie(t,s){var n=document.createElement("option");return n.value=t,n.text=s.CN,s.expired&&(n.style.color="gray",n.text=n.text+" (срок истек)"),O.value.push(s),n.setAttribute("vo",JSON.stringify(s)),n.setAttribute("id",t),n}async function ce(){EIMZOClient.listAllUserKeys(function(t,s){var n="itm-"+t.serialNumber+"-"+s;return n},function(t,s){return ie(t,s)},function(t,s){},function(t,s){c(We)})}function re(){w.value=!0,EIMZOClient.API_KEYS=Se.api_keys,EIMZOClient.checkVersion(function(t,s){var n=h*100+P,i=parseInt(t)*100+parseInt(s);i<n?(w.value=!1,c(Ye)):EIMZOClient.installApiKeys(function(){w.value=!1,ce()},function(u,r){w.value=!1,r&&c(r)})},function(t,s){w.value=!1,c(s||t)})}let L=d(!1);async function de(t){l.value=t;try{L.value=!0;let s=await X.getChallenge();A.value=s.data,await le()}catch{}finally{L.value=!1}}let D=fe({get(){return f.show},set(t){F("update:show",t)}});return(t,s)=>{const n=b("n-alert"),i=b("n-button"),u=b("n-card"),r=b("VLoader"),N=ue,M=b("n-modal");return I(),U(M,{show:o(D),"onUpdate:show":s[2]||(s[2]=a=>$(D)?D.value=a:D=a)},{default:E(()=>[x(u,{onClose:s[1]||(s[1]=a=>$(D)?D.value=!1:D=!1),closable:!0,style:{"max-width":"600px"},title:"Kalitni tanlang"},{default:E(()=>[x(N,{translucent:"",active:f.loading},{default:E(()=>[e("div",Fe,[e("div",null,[e("div",Oe,[t.withComment?(I(),Z("div",Te,[e("p",Ne,C(t.$t("field.comment")),1),ve(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>$(y)?y.value=a:y=a),class:"textarea",style:{"min-height":"50px"}},null,512),[[_e,o(y)]])])):z("",!0),(I(!0),Z(ge,null,he(o(O),(a,v)=>{var _;return I(),Z("div",{class:"col-span-12",key:v},[x(r,{translucent:!0,active:o(p)&&a.serialNumber==((_=o(l))==null?void 0:_.serialNumber)},{default:E(()=>[x(u,{class:"mb-4",style:Ce(new Date(a.validTo).getTime()<Date.now()?"border-color:var(--danger)":"")},{default:E(()=>{var q;return[new Date(a.validTo).getTime()<Date.now()?(I(),U(n,{key:0,class:"mb-2",type:"error",style:{width:"100%"}},{default:E(()=>[J(" Sertifikat amal qilish muddati tugagan! ")]),_:1})):z("",!0),e("div",Me,[e("div",$e,C(a.CN),1),e("div",Ze,[Pe,e("div",null,C(a.TIN),1)]),e("div",Ve,[Le,e("div",null,C(a.PINFL),1)]),e("div",Ue,[ze,e("div",null,C(a.serialNumber),1)]),e("div",Ke,[Re,e("div",null,C(a.O||"-"),1)]),e("div",Je,[He,e("div",null,C(o(Y)(a==null?void 0:a.validFrom))+" dan "+C(o(Y)(a.validTo))+" gacha ",1)]),e("div",qe,[new Date(a.validTo).getTime()>=Date.now()?(I(),U(i,{key:0,onClick:ft=>de(a),type:"info",loading:o(L)&&a.serialNumber==((q=o(l))==null?void 0:q.serialNumber)},{default:E(()=>[J("Ushbu kalitni tanlang")]),_:2},1032,["onClick","loading"])):z("",!0)])])]}),_:2},1032,["style"])]),_:2},1032,["active"])])}),128))])])])]),_:1},8,["active"])]),_:1})]),_:1},8,["show"])}}}),Ge=De(je,[["__scopeId","data-v-190ebdc2"]]),Qe="/img/gerb.png",Xe="/img/main.png",et={class:"site-wrapper h-screen"},tt={class:"site-main"},st={class:"relative"},at={class:"container relative z-10"},nt={class:"grid grid-cols-12"},ot={class:"col-span-12 xl:col-span-7 2xl:col-span-6 xl:text-main"},lt={class:"px-0 2xl:px-10 mt-10"},it=e("div",{class:"flex gap-4"},[e("img",{src:Qe,alt:""}),e("div",{class:"font-semibold text-3xl mt-10"}," Агентство Культурного Наследия Республики Узбекистан ")],-1),ct={class:"grid gap-4 mt-12 max-w-[400px]"},rt={class:"text-xl"},dt=e("p",{class:"mb-1"},"Username",-1),ut=e("p",{class:"mb-1"},"Password",-1),pt={class:"flex mt-4"},mt=xe('<div class="hidden xl:block container-fluid absolute top-10 right-0 left-0"><div class="grid grid-cols-12"><div class="col-span-7 2xl:col-span-6"></div><div class="col-span-5 2xl:col-span-6"><img class="relative object-cover rounded-2xl 2xl:-right-5 right-0 ml-auto right-0 h-[650px]" src="'+Xe+'" alt=""></div></div></div>',1),yt=G({__name:"login",setup(m){const{login:k}=Be();Q.useToast();let g=d(!1),h=d(!1);const P=Ee();let f=d({username:"",password:""});const y=Ie({username:{required:W},password:{required:W}},f);async function O(){return await y.value.$validate()}async function w(){if(await O())try{h.value=!0;let l=await X.login(f.value);k(l.data.data),j.setHeader(),await P.push("/dashboard");return}catch{}finally{h.value=!1}}return(l,p)=>{const T=ke,V=Ae,A=Ge;return I(),Z("div",et,[e("main",tt,[e("div",st,[e("div",at,[e("div",nt,[e("div",ot,[e("div",lt,[it,e("div",ct,[e("div",rt,C(l.$t("info.login")),1),e("div",null,[dt,x(T,{value:o(f).username,"onUpdate:value":p[0]||(p[0]=B=>o(f).username=B),schema:o(y).username},null,8,["value","schema"])]),e("div",null,[ut,x(T,{value:o(f).password,"onUpdate:value":p[1]||(p[1]=B=>o(f).password=B),schema:o(y).password,type:"password","show-password-on":"click"},null,8,["value","schema"])]),e("div",pt,[x(V,{loading:o(h),disabled:o(h),onClick:w,style:{width:"100%"},dark:""},{default:E(()=>[J(C(l.$t("actions.login")),1)]),_:1},8,["loading","disabled"])])])])])])]),mt])]),x(A,{show:o(g),"onUpdate:show":p[2]||(p[2]=B=>$(g)?g.value=B:g=B),isOnlyChallenge:!0,onSuccess:w,loading:o(h)},null,8,["show","loading"])])}}});export{yt as default};
